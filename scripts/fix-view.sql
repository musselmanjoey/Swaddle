-- Fix for track_recommendation_data view\n-- The view had incorrect column references\n\nDROP VIEW IF EXISTS track_recommendation_data;\n\nCREATE OR REPLACE VIEW track_recommendation_data AS\nSELECT \n    t.id as track_id,\n    t.name as track_name,\n    t.artist_id,\n    a.name as artist_name,\n    al.name as album_name,\n    t.danceability,\n    t.energy,\n    t.valence,\n    t.acousticness,\n    t.tempo,\n    t.popularity as spotify_popularity,\n    gsd.popularity_score as genius_popularity,\n    gsd.tags as genius_tags,\n    gsd.pageviews,\n    gsd.annotation_count,\n    COALESCE(gsd.popularity_score, 0) + (t.popularity * 0.1) as combined_popularity_score\nFROM tracks t\nJOIN artists a ON t.artist_id = a.id\nLEFT JOIN albums al ON t.album_id = al.id\nLEFT JOIN genius_song_data gsd ON t.id = gsd.track_id\nWHERE t.audio_features_synced = true;